!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.compose=t()}(this,function(){"use strict";function compareTypes(e,t){return"*"===e?1:"*"===t?-1:"Object"===e?1:"Object"===t?-1:0}function compareNumbers(e,t){return e>t}function Defs(){}function Signature(e,t){this.params="string"==typeof e?""!==e?e.split(",").map(function(e){return e.trim()}):[]:e,this.fn=t}function splitSignatures(e){return Object.keys(e).map(function(t){var n=e[t];return new Signature(t,n)})}function normalizeSignatures(e){var t={};return e.map(function(e){var n=e.params.join(",");if(n in t)throw new Error('Error: signature "'+n+'" defined twice');t[n]=e.fn}),t}function splitTypes(e){var t=[];return e.forEach(function(e){e.params.forEach(function(e,n){t[n]||(t[n]=[]),-1==t[n].indexOf(e)&&t[n].push(e)})}),t}function createParamsTree(e){var t={};return e.forEach(function(e){var n=e.params.concat([]),r=t[n.length];for(r||(r=t[n.length]={signature:[],fn:null,types:{}});n.length>0;){var o=n.shift();r.types[o]||(r.types[o]={signature:r.signature.concat(o),fn:null,types:{}}),r=r.types[o]}r.fn=e.fn}),t}function compose(name,signatures){function switchTypes(e,t,n){var r=[];if(null!==e.fn){var o=defs.add(e.fn,"signature");r.push(n+"return "+o+"("+t.join(", ")+"); // signature: "+e.signature)}else{Object.keys(e.types).sort(compareTypes).forEach(function(o,s){var u,c,a="arg"+t.length,i=n+"  ";if("*"==o)u=s>0?"else {":"",c=s>0?"}":"",0==s&&(i=n);else{var f=defs.add(getTest(o),"test")+"("+a+")";u="if ("+f+") { // type: "+o,c="}"}u&&r.push(n+u),r=r.concat(switchTypes(e.types[o],t.concat(a),i)),c&&r.push(n+c)});var s={};compose.conversions.filter(function(t){return e.types[t.to]&&!e.types[t.from]}).forEach(function(o){if(!s[o.from]){s[o.from]=!0;var u="arg"+t.length,c=defs.add(getTest(o.from),"test")+"("+u+")",a=defs.add(o.convert,"convert")+"("+u+")";r.push(n+"if ("+c+") { // type: "+o.from+", convert to "+o.to),r=r.concat(switchTypes(e.types[o.to],t.concat(a),n+"  ")),r.push(n+"}")}})}return r}signatures||(signatures=name,name=null);for(var defs=new Defs,structure=splitSignatures(signatures),types=splitTypes(structure),params=[],i=0;i<types.length;i++)params.push("arg"+i);var code=[],tree=createParamsTree(structure),paramCounts=Object.keys(tree);code.push("return function "+(name||"")+"("+params.join(", ")+") {"),paramCounts.sort(compareNumbers).forEach(function(e,t){var n=tree[e],r=[],o=0==t?"if":"else if";code.push("  "+o+" (arguments.length == "+e+") {"),code=code.concat(switchTypes(n,r,"    ")),code.push("  }"),t==paramCounts.length-1&&(code.push("  else {"),code.push("    throw new TypeError('Wrong number of arguments');"),code.push("  }"))}),code.push("  throw new TypeError('Wrong function signature');"),code.push("}");var factory=[];factory.push("(function (defs) {"),factory=factory.concat(defs.code("defs")),factory=factory.concat(code),factory.push("})");var fn=eval(factory.join("\n"))(defs);return fn.signatures=normalizeSignatures(structure),fn}function getTest(e){var t=compose.types[e];if(!t){var n=Object.keys(compose.types).filter(function(t){return t.toLowerCase()==e.toLowerCase()}).map(function(e){return'"'+e+'"'});throw new Error('Unknown type "'+e+'"'+(n.length?". Did you mean "+n.join(", or ")+"?":""))}return t}return Defs.prototype.add=function(e,t){t=t||"fn",this[t]||(this[t]=[]);var n=this[t].indexOf(e);return-1==n&&(n=this[t].length,this[t].push(e)),t+n},Defs.prototype.code=function(e){var t=this,n=[];return e=e||"defs",Object.keys(this).forEach(function(r){var o=t[r];o.forEach(function(t,o){n.push("var "+r+o+" = "+e+"['"+r+"']["+o+"];")})}),n},compose.types={"null":function(e){return null===e},"boolean":function(e){return"boolean"==typeof e},number:function(e){return"number"==typeof e},string:function(e){return"string"==typeof e},"function":function(e){return"function"==typeof e},Array:function(e){return Array.isArray(e)},Date:function(e){return e instanceof Date},RegExp:function(e){return e instanceof RegExp},Object:function(e){return"object"==typeof e}},compose.conversions=[],compose});