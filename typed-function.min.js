"use strict";!function(r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():window.typed=r()}(function(){function r(){function t(r){for(var t,n=0;n<x.types.length;n++){var e=x.types[n];if(e.type===r){t=e.test;break}}if(!t){var s;for(n=0;n<x.types.length;n++)if(e=x.types[n],e.type.toLowerCase()==r.toLowerCase()){s=e.type;break}throw new Error('Unknown type "'+r+'"'+(s?'. Did you mean "'+s+'"?':""))}return t}function n(r,t,n,e,s){var i,o=g(e),a=s?s.split(","):null,p=r||"unnamed",u=a&&v(a,"any"),h={fn:r,index:n,actual:e,expected:a};i=a?t>n&&!u?"Unexpected type of argument in function "+p+" (expected: "+a.join(" or ")+", actual: "+o+", index: "+n+")":"Too few arguments in function "+p+" (expected: "+a.join(" or ")+", index: "+n+")":"Too many arguments in function "+p+" (expected: "+n+", actual: "+t+")";var f=new TypeError(i);return f.data=h,f}function e(r){this.name=r||"refs",this.categories={}}function s(r,t){if("string"==typeof r){var n=r.trim(),e="..."===n.substr(0,3);if(e&&(n=n.substr(3)),""===n)this.types=["any"];else{this.types=n.split("|");for(var i=0;i<this.types.length;i++)this.types[i]=this.types[i].trim()}}else{if(!Array.isArray(r)){if(r instanceof s)return r.clone();throw new Error("String or Array expected")}this.types=r}this.conversions=[],this.varArgs=e||t||!1,this.anyType=-1!==this.types.indexOf("any")}function i(r,t){var n;if("string"==typeof r)n=""!==r?r.split(","):[];else{if(!Array.isArray(r))throw new Error("string or Array expected");n=r}this.params=new Array(n.length);for(var e=0;e<n.length;e++){var i=new s(n[e]);if(this.params[e]=i,e===n.length-1)this.varArgs=i.varArgs;else if(i.varArgs)throw new SyntaxError('Unexpected variable arguments operator "..."')}this.fn=t}function o(r,t,n){this.path=r||[],this.param=r[r.length-1]||null,this.signature=t||null,this.childs=n||[]}function a(r){var t,n,e={},s=[];for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];if(t=new i(o,a),t.ignore())continue;var p=t.expand();for(n=0;n<p.length;n++){var u=p[n],h=u.toString(),f=e[h];if(f){var c=i.compare(u,f);if(0>c)e[h]=u;else if(0===c)throw new Error('Signature "'+h+'" is defined twice')}else e[h]=u}}for(h in e)e.hasOwnProperty(h)&&s.push(e[h]);for(s.sort(function(r,t){return i.compare(r,t)}),n=0;n<s.length;n++)if(t=s[n],t.varArgs)for(var g=t.params.length-1,y=t.params[g],l=0;l<y.types.length;){if(y.conversions[l])for(var m=y.types[l],d=0;d<s.length;d++){var w=s[d],A=w.params[g];if(w!==t&&A&&v(A.types,m)&&!A.conversions[g]){y.types.splice(l,1),y.conversions.splice(l,1),l--;break}}l++}return s}function p(r){for(var t={},n=0;n<r.length;n++){var e=r[n];if(e.fn&&!e.hasConversions()){var s=e.params.join(",");t[s]=e.fn}}return t}function u(r,t){var n,e,i,a=t.length,p=[];for(n=0;n<r.length;n++)e=r[n],e.params.length!==a||i||(i=e),void 0!=e.params[a]&&p.push(e);p.sort(function(r,t){return s.compare(r.params[a],t.params[a])});var h=[];for(n=0;n<p.length;n++){e=p[n];var f=e.params[a],c=h.filter(function(r){return r.param.overlapping(f)})[0];if(c){if(c.param.varArgs)throw new Error('Conflicting types "'+c.param+'" and "'+f+'"');c.signatures.push(e)}else h.push({param:f,signatures:[e]})}var g=new Array(h.length);for(n=0;n<h.length;n++){var v=h[n];g[n]=u(v.signatures,t.concat(v.param))}return new o(t,i,g)}function h(r){for(var t=[],n=0;r>n;n++)t[n]="arg"+n;return t}function f(r,t){var s=new e,i=a(t);if(0==i.length)throw new Error("No signatures provided");var o=u(i,[]),f=[],g=r||"",v=h(c(i));f.push("function "+g+"("+v.join(", ")+") {"),f.push('  "use strict";'),f.push("  var name = '"+g+"';"),f.push(o.toCode(s,"  ")),f.push("}");var y=[s.toCode(),"return "+f.join("\n")].join("\n"),l=new Function(s.name,"createError",y),m=l(s,n);return m.signatures=p(i),m}function c(r){for(var t=0,n=0;n<r.length;n++){var e=r[n].params.length;e>t&&(t=e)}return t}function g(r){for(var t,n=0;n<x.types.length;n++){var e=x.types[n];if("Object"===e.type)t=e;else if(e.test(r))return e.type}return t&&t.test(r)?t.type:"unknown"}function v(r,t){return-1!==r.indexOf(t)}function y(r,t){if(!r.signatures)throw new TypeError("Function is no typed-function");var n;if("string"==typeof t){n=t.split(",");for(var e=0;e<n.length;e++)n[e]=n[e].trim()}else{if(!Array.isArray(t))throw new TypeError("String array or a comma separated string expected");n=t}var s=n.join(","),i=r.signatures[s];if(i)return i;throw new TypeError("Signature not found (signature: "+(r.name||"unnamed")+"("+n.join(", ")+"))")}function l(r,t){var n=g(r);if(t===n)return r;for(var e=0;e<x.conversions.length;e++){var s=x.conversions[e];if(s.from===n&&s.to===t)return s.convert(r)}throw new Error("Cannot convert from "+n+" to "+t)}e.prototype.add=function(r,t){var n=t||"fn";this.categories[n]||(this.categories[n]=[]);var e=this.categories[n].indexOf(r);return-1==e&&(e=this.categories[n].length,this.categories[n].push(r)),n+e},e.prototype.toCode=function(){var r=[],t=this.name+".categories",n=this.categories;for(var e in n)if(n.hasOwnProperty(e))for(var s=n[e],i=0;i<s.length;i++)r.push("var "+e+i+" = "+t+"['"+e+"']["+i+"];");return r.join("\n")},s.compare=function(r,t){if(r.anyType)return 1;if(t.anyType)return-1;if(v(r.types,"Object"))return 1;if(v(t.types,"Object"))return-1;if(r.hasConversions()){if(t.hasConversions()){var n,e,s;for(n=0;n<r.conversions.length;n++)if(void 0!==r.conversions[n]){e=r.conversions[n];break}for(n=0;n<t.conversions.length;n++)if(void 0!==t.conversions[n]){s=t.conversions[n];break}return x.conversions.indexOf(e)-x.conversions.indexOf(s)}return 1}if(t.hasConversions())return-1;var i,o;for(n=0;n<x.types.length;n++)if(x.types[n].type===r.types[0]){i=n;break}for(n=0;n<x.types.length;n++)if(x.types[n].type===t.types[0]){o=n;break}return i-o},s.prototype.overlapping=function(r){for(var t=0;t<this.types.length;t++)if(v(r.types,this.types[t]))return!0;return!1},s.prototype.clone=function(){var r=new s(this.types.slice(),this.varArgs);return r.conversions=this.conversions.slice(),r},s.prototype.hasConversions=function(){return this.conversions.length>0},s.prototype.contains=function(r){for(var t=0;t<this.types.length;t++)if(r[this.types[t]])return!0;return!1},s.prototype.toString=function(r){for(var t=[],n={},e=0;e<this.types.length;e++){var s=this.conversions[e],i=r&&s?s.to:this.types[e];i in n||(n[i]=!0,t.push(i))}return(this.varArgs?"...":"")+t.join("|")},i.prototype.clone=function(){return new i(this.params.slice(),this.fn)},i.prototype.expand=function(){function r(n,e){if(e.length<n.params.length){var o,a,p,u=n.params[e.length];if(u.varArgs){for(a=u.clone(),o=0;o<x.conversions.length;o++)if(p=x.conversions[o],!v(u.types,p.from)&&v(u.types,p.to)){var h=a.types.length;a.types[h]=p.from,a.conversions[h]=p}r(n,e.concat(a))}else{for(o=0;o<u.types.length;o++)r(n,e.concat(new s(u.types[o])));for(o=0;o<x.conversions.length;o++)p=x.conversions[o],!v(u.types,p.from)&&v(u.types,p.to)&&(a=new s(p.from),a.conversions[0]=p,r(n,e.concat(a)))}}else t.push(new i(e,n.fn))}var t=[];return r(this,[]),t},i.compare=function(r,t){if(r.params.length>t.params.length)return 1;if(r.params.length<t.params.length)return-1;var n,e=r.params.length,i=0,o=0;for(n=0;e>n;n++)r.params[n].hasConversions()&&i++,t.params[n].hasConversions()&&o++;if(i>o)return 1;if(o>i)return-1;for(n=0;n<r.params.length;n++){var a=s.compare(r.params[n],t.params[n]);if(0!==a)return a}return 0},i.prototype.hasConversions=function(){for(var r=0;r<this.params.length;r++)if(this.params[r].hasConversions())return!0;return!1},i.prototype.ignore=function(){for(var r={},t=0;t<x.ignore.length;t++)r[x.ignore[t]]=!0;for(t=0;t<this.params.length;t++)if(this.params[t].contains(r))return!0;return!1},i.prototype.toCode=function(r,t){for(var n=[],e=new Array(this.params.length),s=0;s<this.params.length;s++){var i=this.params[s],o=i.conversions[0];i.varArgs?e[s]="varArgs":o?e[s]=r.add(o.convert,"convert")+"(arg"+s+")":e[s]="arg"+s}var a=this.fn?r.add(this.fn,"signature"):void 0;return a?t+"return "+a+"("+e.join(", ")+"); // signature: "+this.params.join(", "):n.join("\n")},i.prototype.toString=function(){return this.params.join(", ")},o.prototype.toCode=function(r,n,e){var s=[];if(this.param){var i=this.path.length-1,o=this.param.conversions[0],a="// type: "+(o?o.from+" (convert to "+o.to+")":this.param);if(this.param.varArgs)if(this.param.anyType)s.push(n+"if (arguments.length > "+i+") {"),s.push(n+"  var varArgs = [];"),s.push(n+"  for (var i = "+i+"; i < arguments.length; i++) {"),s.push(n+"    varArgs.push(arguments[i]);"),s.push(n+"  }"),s.push(this.signature.toCode(r,n+"  ")),s.push(n+"}");else{for(var p=function(n,e){for(var s=[],i=0;i<n.length;i++)s[i]=r.add(t(n[i]),"test")+"("+e+")";return s.join(" || ")}.bind(this),u=this.param.types,h=[],f=0;f<u.length;f++)void 0===this.param.conversions[f]&&h.push(u[f]);s.push(n+"if ("+p(u,"arg"+i)+") { "+a),s.push(n+"  var varArgs = [arg"+i+"];"),s.push(n+"  for (var i = "+(i+1)+"; i < arguments.length; i++) {"),s.push(n+"    if ("+p(h,"arguments[i]")+") {"),s.push(n+"      varArgs.push(arguments[i]);");for(var f=0;f<u.length;f++){var c=this.param.conversions[f];if(c){var g=r.add(t(u[f]),"test"),v=r.add(c.convert,"convert");s.push(n+"    }"),s.push(n+"    else if ("+g+"(arguments[i])) {"),s.push(n+"      varArgs.push("+v+"(arguments[i]));")}}s.push(n+"    } else {"),s.push(n+"      throw createError(name, arguments.length, i, arguments[i], '"+u.join(",")+"');"),s.push(n+"    }"),s.push(n+"  }"),s.push(this.signature.toCode(r,n+"  ")),s.push(n+"}")}else if(this.param.anyType)s.push(n+"// type: any"),s.push(this._innerCode(r,n,e));else{var y=this.param.types[0],g="any"!==y?r.add(t(y),"test"):null;s.push(n+"if ("+g+"(arg"+i+")) { "+a),s.push(this._innerCode(r,n+"  ",e)),s.push(n+"}")}}else s.push(this._innerCode(r,n,e));return s.join("\n")},o.prototype._innerCode=function(r,t,n){var e,s=[];this.signature&&(s.push(t+"if (arguments.length === "+this.path.length+") {"),s.push(this.signature.toCode(r,t+"  ")),s.push(t+"}"));var i;for(e=0;e<this.childs.length;e++)if(this.childs[e].param.anyType){i=this.childs[e];break}for(e=0;e<this.childs.length;e++)s.push(this.childs[e].toCode(r,t,i));n&&!this.param.anyType&&s.push(n.toCode(r,t,i));var o=this._exceptions(r,t);return o&&s.push(o),s.join("\n")},o.prototype._exceptions=function(r,t){var n=this.path.length;if(0===this.childs.length)return[t+"if (arguments.length > "+n+") {",t+"  throw createError(name, arguments.length, "+n+", arguments["+n+"]);",t+"}"].join("\n");for(var e={},s=[],i=0;i<this.childs.length;i++){var o=this.childs[i];if(o.param)for(var a=0;a<o.param.types.length;a++){var p=o.param.types[a];p in e||(e[p]=!0,s.push(p))}}return t+"throw createError(name, arguments.length, "+n+", arguments["+n+"], '"+s.join(",")+"');"};var m=[{type:"number",test:function(r){return"number"==typeof r}},{type:"string",test:function(r){return"string"==typeof r}},{type:"boolean",test:function(r){return"boolean"==typeof r}},{type:"function",test:function(r){return"function"==typeof r}},{type:"Array",test:Array.isArray},{type:"Date",test:function(r){return r instanceof Date}},{type:"RegExp",test:function(r){return r instanceof RegExp}},{type:"Object",test:function(r){return"object"==typeof r}},{type:"null",test:function(r){return null===r}},{type:"undefined",test:function(r){return void 0===r}}],d={},w=[],A=[],x={config:d,types:m,conversions:w,ignore:A};return x=f("typed",{Object:function(r){return f(null,r)},"string, Object":f,"string, function":function(r,t){var n={};return n[r]=t,f(t.name||null,n)},"string, string, function":function(r,t,n){var e={};return e[t]=n,f(r,e)},"...function":function(r){for(var t,n="",e={},s=0;s<r.length;s++){var i=r[s];if("object"!=typeof i.signatures)throw t=new TypeError("Function is no typed-function (index: "+s+")"),t.data={index:s},t;for(var o in i.signatures)if(i.signatures.hasOwnProperty(o))if(e.hasOwnProperty(o)){if(i.signatures[o]!==e[o])throw t=new Error('Signature "'+o+'" is defined twice'),t.data={signature:o},t}else e[o]=i.signatures[o];if(""!=i.name)if(""==n)n=i.name;else if(n!=i.name)throw t=new Error("Function names do not match (expected: "+n+", actual: "+i.name+")"),t.data={actual:i.name,expected:n},t}return f(n,e)}}),x.config=d,x.types=m,x.conversions=w,x.ignore=A,x.create=r,x.find=y,x.convert=l,x}return r()});