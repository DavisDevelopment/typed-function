!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.typed=t()}(this,function(){"use strict";function compareTypes(e,t){return"any"===e?1:"any"===t?-1:"Object"===e?1:"Object"===t?-1:0}function merge(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}function last(e){return e[e.length-1]}function getTypeTest(e){var t=typed.types[e];if(!t){var r=Object.keys(typed.types).filter(function(t){return t.toLowerCase()==e.toLowerCase()}).map(function(e){return'"'+e+'"'});throw new Error('Unknown type "'+e+'"'+(r.length?". Did you mean "+r.join(", or ")+"?":""))}return t}function Refs(e){this.name=e||"refs",this.categories={}}function Param(e,t){if("string"==typeof e)this.types=e.split("|").map(function(e){return e.trim()});else{if(!Array.isArray(e)){if(e instanceof Param)return e.clone();throw new Error("String or Array expected")}this.types=e}void 0!==this.types[0]&&"..."==this.types[0].substring(0,3)?(this.types[0]=this.types[0].substring(3)||"any",this.variable=!0):this.variable=t||!1}function Signature(e,t){if("string"==typeof e)this.params=""!==e?e.split(",").map(function(e){return new Param(e)}):[];else{if(!Array.isArray(e))throw new Error("string or Array expected");this.params=e.map(function(e){return new Param(e)})}var r=this.params.filter(function(e){return e.variable});if(0===r.length)this.variable=!1;else{if(r[0]!==this.params[this.params.length-1])throw new SyntaxError('Unexpected variable arguments operator "..."');this.variable=!0}this.fn=t}function Node(e){this.type=e,this.fn=null,this.variable=!1,this.childs={}}function RootNode(e){this.name=e||"",this.fn=null,this.childs={}}function splitSignatures(e){return Object.keys(e).reduce(function(t,r){var n=e[r],s=new Signature(r,n);return t.concat(s.split())},[])}function normalizeSignatures(e){var t={};return e.map(function(e){var r=e.params.join(",");if(r in t)throw new Error('Error: signature "'+r+'" defined twice');t[r]=e.fn}),t}function parseSignatures(e,t){var r=new RootNode(e);return t.forEach(function(e){for(var t=e.params.concat([]),n=r;t.length>0;){var s=t.shift(),i=s.types[0],o=n.childs[i];void 0===o&&(o=n.childs[i]=new Node(s)),n=o}n.fn=e.fn,n.variable=e.variable}),r}function minify(e){return e.replace(/\/\/.*/g,"").replace(/\s*\n\s*/gm,"").replace(/ \{/g,"{").replace(/ \(/g,"(").replace(/(signature|test|convert|arg)(?=\d)/g,function(e){return e.charAt(0)})}function _typed(name,signatures){var refs=new Refs,structure=splitSignatures(signatures),tree=parseSignatures(name,structure),treeCode=tree.toCode(refs),refsCode=refs.toCode(),factory=["(function ("+refs.name+") {",refsCode,treeCode,"})"].join("\n");typed.config.minify&&(factory=minify(factory));var fn=eval(factory)(refs);return fn.signatures=normalizeSignatures(structure),fn}Refs.prototype.add=function(e,t){var r=t||"fn";this.categories[r]||(this.categories[r]=[]);var n=this.categories[r].indexOf(e);return-1==n&&(n=this.categories[r].length,this.categories[r].push(e)),r+n},Refs.prototype.toCode=function(){var e=[],t=this.name+".categories",r=this.categories;return Object.keys(r).forEach(function(n){r[n].forEach(function(r,s){e.push("var "+n+s+" = "+t+"['"+n+"']["+s+"];")})}),e.join("\n")},Param.prototype.clone=function(){return new Param(this.types.slice(),this.variable)},Param.prototype.toString=function(){return(this.variable?"...":"")+this.types.join("|")},Signature.prototype.split=function(){function e(r,n,s){if(s<r.params.length){var i=r.params[s];i.types.forEach(function(t){e(r,n.concat(new Param(t,i.variable)),s+1)})}else t.push(new Signature(n,r.fn))}var t=[];return e(this,[],0),t},Node.prototype.depth=function(){var e=0;return Object.keys(this.childs).forEach(function(t){var r=this.childs[t].depth()+1;e=Math.max(e,r)}.bind(this)),e},Node.prototype._toCode=function(e){var t=[],r=last(e.args),n=last(e.types),s=last(e.tests);return this.variable?"any"==n?(t.push(e.prefix+"var varArgs = [];"),t.push(e.prefix+"for (var i = "+(e.args.length-1)+"; i < arguments.length; i++) {"),t.push(e.prefix+"  varArgs.push(arguments[i]);"),t.push(e.prefix+"}"),t=t.concat(this._innerCode(e))):(t.push(e.prefix+"var match = true;"),t.push(e.prefix+"var varArgs = [];"),t.push(e.prefix+"for (var i = "+(e.args.length-1)+"; i < arguments.length; i++) {"),t.push(e.prefix+"  if ("+s+"(arguments[i])) {"),t.push(e.prefix+"    varArgs.push(arguments[i]);"),t.push(e.prefix+"  } else {"),t.push(e.prefix+"    match = false;"),t.push(e.prefix+"    break;"),t.push(e.prefix+"  }"),t.push(e.prefix+"}"),t.push(e.prefix+"if (match) {"),t=t.concat(this._innerCode(merge(e,{prefix:e.prefix+"  "}))),t.push(e.prefix+"}")):"any"==n||void 0===n?t=t.concat(this._innerCode(e)):(t.push(e.prefix+"if ("+s+"("+r+")) { // type: "+n),t=t.concat(this._innerCode(merge(e,{prefix:e.prefix+"  "}))),t.push(e.prefix+"}")),t.join("\n")},Node.prototype._innerCode=function(e){var t=[];if(this.fn){var r=this.variable?">=":"===",n=e.refs.add(this.fn,"signature");t.push(e.prefix+"if (arguments.length "+r+" "+e.args.length+") {"),t.push(e.prefix+"  return "+n+"("+e.args.join(", ")+"); // signature: "+e.types.join(", ")),t.push(e.prefix+"}")}return e.conversions?t=t.concat(this._conversionsToCode(e)):this.forEach(function(r){var n=r.variable?"varArgs":"arg"+e.args.length,s=void 0!==r.type?r.type.types[0]:void 0,i="any"!=s?e.refs.add(getTypeTest(s),"test"):"";t.push(r._toCode(merge(e,{args:e.args.concat(n),types:e.types.concat(s),tests:e.tests.concat(i)})))}),e.exceptions,t},Node.prototype._conversionsToCode=function(e){var t=[],r={};return this.forEach(function(r){var n=r.variable?"varArgs":"arg"+e.args.length,s=void 0!==r.type?r.type.types[0]:void 0,i="any"!=s?e.refs.add(getTypeTest(s),"test"):"";t.push(r._toCode(merge(e,{args:e.args.concat(n),types:e.types.concat(s),tests:e.tests.concat(i)})))}),typed.conversions.filter(function(e){return void 0===this.childs[e.to]||r[e.from]?!1:(r[e.from]=!0,!0)}.bind(this)).forEach(function(r){var n,s,i=r.to,o=this.childs[i];o.variable?(t.push(e.prefix+"var match = true;"),t.push(e.prefix+"var varArgs = [];"),t.push(e.prefix+"for (var i = "+e.args.length+"; i < arguments.length; i++) {"),n=e.refs.add(getTypeTest(i),"test")+"(arguments[i])",t.push(e.prefix+"  if ("+n+") { // type: "+r.to),t.push(e.prefix+"    varArgs.push(arguments[i]);"),typed.conversions.filter(function(e){return e.to==i}).forEach(function(r){var n=e.refs.add(getTypeTest(r.from),"test")+"(arguments[i])",s=e.refs.add(r.convert,"convert")+"(arguments[i])";t.push(e.prefix+"  } else if ("+n+") { // type: "+r.from+", convert to "+r.to),t.push(e.prefix+"    varArgs.push("+s+");")}),t.push(e.prefix+"  } else {"),t.push(e.prefix+"    match = false;"),t.push(e.prefix+"    break;"),t.push(e.prefix+"  }"),t.push(e.prefix+"}"),t.push(e.prefix+"if (match) {"),t=t.concat(o._innerCode(merge(e,{args:e.args.concat("varArgs"),types:e.types.concat(i),tests:e.tests.concat(n),prefix:e.prefix+"  "}))),t.push(e.prefix+"}")):(n=e.refs.add(getTypeTest(r.from),"test")+"(arg"+e.args.length+")",s=e.refs.add(r.convert,"convert")+"(arg"+e.args.length+")",t.push(e.prefix+"if ("+n+") { // type: "+r.from+", convert to "+r.to),t=t.concat(o._innerCode(merge(e,{args:e.args.concat(s),types:e.types.concat(i),tests:e.tests.concat(n),prefix:e.prefix+"  "}))),t.push(e.prefix+"}"))}.bind(this)),t},Node.prototype.forEach=function(e){Object.keys(this.childs).sort(compareTypes).forEach(function(t){e(this.childs[t])}.bind(this))},RootNode.prototype=Object.create(Node.prototype),RootNode.prototype.toCode=function(e){for(var t=[],r=this.depth(),n=[],s=0;r>s;s++)n[s]="arg"+s;var i=typed.conversions.length>0;return t.push("return function "+this.name+"("+n.join(", ")+") {"),i?(t.push("  // exactly matching signatures"),t=t.concat(this._toCode({refs:e,args:[],types:[],tests:[],prefix:"  ",conversions:!1,exceptions:!1})),t.push("  // convert into matching signatures"),t=t.concat(this._conversionsToCode({refs:e,args:[],types:[],tests:[],prefix:"  ",conversions:!0,exceptions:!0}))):(t.push("  // exactly matching signatures"),t=t.concat(this._toCode({refs:e,args:[],types:[],tests:[],prefix:"  ",conversions:!1,exceptions:!0}))),t.push("  throw new TypeError('Wrong function signature');"),t.push("}"),t.join("\n")};var types={"null":function(e){return null===e},"boolean":function(e){return"boolean"==typeof e},number:function(e){return"number"==typeof e},string:function(e){return"string"==typeof e},"function":function(e){return"function"==typeof e},Array:function(e){return Array.isArray(e)},Date:function(e){return e instanceof Date},RegExp:function(e){return e instanceof RegExp},Object:function(e){return"object"==typeof e}},config={minify:!0},conversions=[],typed={config:config,types:types,conversions:conversions};return typed=_typed("typed",{Object:function(e){return _typed(null,e)},"string, Object":_typed,"string, function":function(e,t){var r={};return r[e]=t,_typed(null,r)},"string, string, function":function(e,t,r){var n={};return n[t]=r,_typed(e,n)}}),typed.config=config,typed.types=types,typed.conversions=conversions,typed});