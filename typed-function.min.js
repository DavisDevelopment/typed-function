"use strict";!function(n,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():n.typed=r()}(this,function(){function n(){return!0}function r(){return!1}function t(){}function e(){function a(n){var r=Y.types.find(function(r){return r.name===n});if(r)return r;if("any"===n)return Q;var t=Y.types.find(function(r){return r.name.toLowerCase()===n.toLowerCase()});throw new TypeError('Unknown type "'+n+'"'+(t?'. Did you mean "'+t.name+'"?':""))}function o(n){return n===Q?999:Y.types.indexOf(n)}function u(n){var r=Y.types.find(function(r){return r.test(n)});if(r)return r.name;throw new TypeError("Value has unknown type. Value: "+n)}function i(n,r){if(!n.signatures)throw new TypeError("Function is no typed-function");var t;if("string"==typeof r){t=r.split(",");for(var e=0;e<t.length;e++)t[e]=t[e].trim()}else{if(!Array.isArray(r))throw new TypeError("String array or a comma separated string expected");t=r}var a=t.join(","),o=n.signatures[a];if(o)return o;throw new TypeError("Signature not found (signature: "+(n.name||"unnamed")+"("+t.join(", ")+"))")}function f(n,r){var t=u(n);if(r===t)return n;for(var e=0;e<Y.conversions.length;e++){var a=Y.conversions[e];if(a.from===t&&a.to===r)return a.convert(n)}throw new Error("Cannot convert from "+t+" to "+r)}function s(n){return n.map(function(n){var r=n.types.map(d);return(n.restParam?"...":"")+r.join("|")}).join(",")}function p(n,r){var t=0===n.indexOf("..."),e=(t?n.length>3?n.slice(3):"any":n).split("|").map(D).filter(L).filter(S),u=P(r,e),i=e.map(function(n){var r=a(n);return{name:n,typeIndex:o(r),test:r.test,conversion:null,conversionIndex:-1}}),f=u.map(function(n){var t=a(n.from);return{name:n.from,typeIndex:o(t),test:t.test,conversion:n,conversionIndex:r.indexOf(n)}});return{types:i.concat(f),restParam:t}}function c(n,r,t){var e=[];return""!==n.trim()&&(e=n.split(",").map(D).map(function(n,r,e){var a=p(n,t);if(a.restParam&&r!==e.length-1)throw new SyntaxError('Unexpected rest parameter "'+n+'": only allowed for the last parameter');return a})),e.some(R)?null:{params:e,fn:r}}function l(n){var r=N(n);return!!r&&r.restParam}function m(n){return n.types.some(function(n){return null!=n.conversion})}function g(r){if(r&&0!==r.types.length){if(1===r.types.length)return a(r.types[0].name).test;if(2===r.types.length){var t=a(r.types[0].name).test,e=a(r.types[1].name).test;return function(n){return t(n)||e(n)}}var o=r.types.map(function(n){return a(n.name).test});return function(n){for(var r=0;r<o.length;r++)if(o[r](n))return!0;return!1}}return n}function h(n){var r,t,e;if(l(n)){var a=(r=V(n).map(g)).length,o=g(N(n)),u=function(n){for(var r=a;r<n.length;r++)if(!o(n[r]))return!1;return!0};return function(n){for(var t=0;t<r.length;t++)if(!r[t](n[t]))return!1;return u(n)&&n.length>=a+1}}return 0===n.length?function(n){return 0===n.length}:1===n.length?(t=g(n[0]),function(n){return t(n[0])&&1===n.length}):2===n.length?(t=g(n[0]),e=g(n[1]),function(n){return t(n[0])&&e(n[1])&&2===n.length}):(r=n.map(g),function(n){for(var t=0;t<r.length;t++)if(!r[t](n[t]))return!1;return n.length===r.length})}function y(n,r){return r<n.params.length?n.params[r]:l(n.params)?N(n.params):null}function v(n,r,t){var e=y(n,r);return(e?t?e.types.filter(w):e.types:[]).map(d)}function d(n){return n.name}function w(n){return null===n.conversion||void 0===n.conversion}function x(n,r){var t=G(H(n,function(n){return v(n,r,!1)}));return-1!==t.indexOf("any")?["any"]:t}function E(n,r,t){var e,a,o,i=n||"unnamed",f=t;for(o=0;o<r.length;o++){var s=f.filter(function(n){var t=g(y(n,o));return(o<n.params.length||l(n.params))&&t(r[o])});if(0===s.length){if((a=x(f,o)).length>0){var p=u(r[o]);return e=new TypeError("Unexpected type of argument in function "+i+" (expected: "+a.join(" or ")+", actual: "+p+", index: "+o+")"),e.data={category:"wrongType",fn:i,index:o,actual:p,expected:a},e}}else f=s}var c=f.map(function(n){return l(n.params)?1/0:n.params.length});if(r.length<Math.min.apply(null,c))return a=x(f,o),e=new TypeError("Too few arguments in function "+i+" (expected: "+a.join(" or ")+", index: "+r.length+")"),e.data={category:"tooFewArgs",fn:i,index:r.length,expected:a},e;var m=Math.max.apply(null,c);return r.length>m?(e=new TypeError("Too many arguments in function "+i+" (expected: "+m+", actual: "+r.length+")"),e.data={category:"tooManyArgs",fn:i,index:r.length,expectedLength:m},e):(e=new TypeError('Arguments of type "'+r.join(", ")+'" do not match any of the defined signatures of function '+i+"."),e.data={category:"mismatch",actual:r.map(u)},e)}function O(n){for(var r=999,t=0;t<n.types.length;t++)w(n.types[t])&&(r=Math.min(r,n.types[t].typeIndex));return r}function j(n){for(var r=999,t=0;t<n.types.length;t++)w(n.types[t])||(r=Math.min(r,n.types[t].conversionIndex));return r}function b(n,r){var t;return 0!==(t=n.restParam-r.restParam)?t:0!==(t=m(n)-m(r))?t:(t=O(n)-O(r),0!==t?t:j(n)-j(r))}function T(n,r){var t,e,a=Math.min(n.params.length,r.params.length);if(0!==(e=n.params.some(m)-r.params.some(m)))return e;for(t=0;t<a;t++)if(0!==(e=m(n.params[t])-m(r.params[t])))return e;for(t=0;t<a;t++)if(0!==(e=b(n.params[t],r.params[t])))return e;return n.params.length-r.params.length}function P(n,r){var t={};return n.forEach(function(n){-1!==r.indexOf(n.from)||-1===r.indexOf(n.to)||t[n.from]||(t[n.from]=n)}),Object.keys(t).map(function(n){return t[n]})}function A(n,r){var t=r;if(n.some(m)){var e=l(n),a=n.map(M);t=function(){for(var n=[],t=e?arguments.length-1:arguments.length,o=0;o<t;o++)n[o]=a[o](arguments[o]);return e&&(n[t]=arguments[t].map(a[t])),r.apply(null,n)}}var o=t;if(l(n)){var u=n.length-1;o=function(){return t.apply(null,q(arguments,0,u).concat([q(arguments,u)]))}}return o}function M(n){var r,t,e,o,u=[],i=[];switch(n.types.forEach(function(n){n.conversion&&(u.push(a(n.conversion.from).test),i.push(n.conversion.convert))}),i.length){case 0:return function(n){return n};case 1:return r=u[0],e=i[0],function(n){return r(n)?e(n):n};case 2:return r=u[0],t=u[1],e=i[0],o=i[1],function(n){return r(n)?e(n):t(n)?o(n):n};default:return function(n){for(var r=0;r<i.length;r++)if(u[r](n))return i[r](n);return n}}}function k(n){var r={};return n.forEach(function(n){n.params.some(m)||F(n.params,!0).forEach(function(t){r[s(t)]=n.fn})}),r}function F(n,r){function t(n,e,a){if(e<n.length){var o,u=n[e],i=r?u.types.filter(w):u.types;if(u.restParam){var f=i.filter(w);o=f.length<i.length?[f,i]:[i]}else o=i.map(function(n){return[n]});return H(o,function(r){return t(n,e+1,a.concat([r]))})}return[a.map(function(r,t){return{types:r,restParam:t===n.length-1&&l(n)}})]}return t(n,0,[])}function I(n,r){for(var t=Math.max(n.params.length,r.params.length),e=0;e<t;e++)if(!B(v(n,e,!0),v(r,e,!0)))return!1;var a=n.params.length,o=r.params.length,u=l(n.params),i=l(r.params);return u?i?a===o:o>=a:i?a>=o:a===o}function C(n,e){if(0===Object.keys(e).length)throw new SyntaxError("No signatures provided");var a=[];Object.keys(e).map(function(n){return c(n,e[n],Y.conversions)}).filter(U).forEach(function(n){var r=a.find(function(r){return I(r,n)});if(r)throw new TypeError('Conflicting signatures "'+s(r.params)+'" and "'+s(n.params)+'".');a.push(n)});var o=H(a,function(n){return(n?F(n.params,!1):[]).map(function(r){return{params:r,fn:n.fn}})}).filter(U);o.sort(T);var u=o[0]&&o[0].params.length<=2&&!l(o[0].params),i=o[1]&&o[1].params.length<=2&&!l(o[1].params),f=o[2]&&o[2].params.length<=2&&!l(o[2].params),p=o[3]&&o[3].params.length<=2&&!l(o[3].params),m=o[4]&&o[4].params.length<=2&&!l(o[4].params),y=o[5]&&o[5].params.length<=2&&!l(o[5].params),v=u&&i&&f&&p&&m&&y,d=o.map(function(n){return h(n.params)}),w=u?g(o[0].params[0]):r,x=i?g(o[1].params[0]):r,O=f?g(o[2].params[0]):r,j=p?g(o[3].params[0]):r,b=m?g(o[4].params[0]):r,P=y?g(o[5].params[0]):r,M=u?g(o[0].params[1]):r,C=i?g(o[1].params[1]):r,S=f?g(o[2].params[1]):r,D=p?g(o[3].params[1]):r,L=m?g(o[4].params[1]):r,R=y?g(o[5].params[1]):r,V=o.map(function(n){return A(n.params,n.fn)}),N=u?V[0]:t,q=i?V[1]:t,z=f?V[2]:t,B=p?V[3]:t,G=m?V[4]:t,J=y?V[5]:t,K=u?o[0].params.length:-1,Q=i?o[1].params.length:-1,W=f?o[2].params.length:-1,X=p?o[3].params.length:-1,Z=m?o[4].params.length:-1,$=y?o[5].params.length:-1,_=v?6:0,nn=o.length,rn=function(){for(var r=_;r<nn;r++)if(d[r](arguments))return V[r].apply(null,arguments);throw E(n,arguments,o)},tn=function(n,r){return arguments.length===K&&w(n)&&M(r)?N.apply(null,arguments):arguments.length===Q&&x(n)&&C(r)?q.apply(null,arguments):arguments.length===W&&O(n)&&S(r)?z.apply(null,arguments):arguments.length===X&&j(n)&&D(r)?B.apply(null,arguments):arguments.length===Z&&b(n)&&L(r)?G.apply(null,arguments):arguments.length===$&&P(n)&&R(r)?J.apply(null,arguments):rn.apply(null,arguments)};return Object.defineProperty(tn,"name",{value:n}),tn.signatures=k(o),tn}function S(n){return-1===Y.ignore.indexOf(n)}function D(n){return n.trim()}function L(n){return!!n}function U(n){return null!==n}function R(n){return 0===n.types.length}function V(n){return n.slice(0,n.length-1)}function N(n){return n[n.length-1]}function q(n,r,t){return Array.prototype.slice.call(n,r,t)}function z(n,r){return-1!==n.indexOf(r)}function B(n,r){for(var t=0;t<n.length;t++)if(z(r,n[t]))return!0;return!1}function G(n){for(var r={},t=0;t<n.length;t++)r[n[t]]=!0;return Object.keys(r)}function H(n,r){return Array.prototype.concat.apply([],n.map(r))}function J(n){for(var r="",t=0;t<n.length;t++){var e=n[t];if(e.signatures&&""!==e.name)if(""===r)r=e.name;else if(r!==e.name){var a=new Error("Function names do not match (expected: "+r+", actual: "+e.name+")");throw a.data={actual:e.name,expected:r},a}}return r}var K=[{name:"number",test:function(n){return"number"==typeof n}},{name:"string",test:function(n){return"string"==typeof n}},{name:"boolean",test:function(n){return"boolean"==typeof n}},{name:"Function",test:function(n){return"function"==typeof n}},{name:"Array",test:Array.isArray},{name:"Date",test:function(n){return n instanceof Date}},{name:"RegExp",test:function(n){return n instanceof RegExp}},{name:"Object",test:function(n){return"object"==typeof n&&n.constructor===Object}},{name:"null",test:function(n){return null===n}},{name:"undefined",test:function(n){return void 0===n}}],Q={name:"any",test:n},W=[],X=[],Y={types:K,conversions:X,ignore:W};return Y=C("typed",{"string, Object":C,Object:function(n){var r=[];for(var t in n)n.hasOwnProperty(t)&&r.push(n[t]);return C(J(r),n)},"...Function":function(n){for(var r,t=J(n),e={},a=0;a<n.length;a++){var o=n[a];if("object"!=typeof o.signatures)throw r=new TypeError("Function is no typed-function (index: "+a+")"),r.data={index:a},r;for(var u in o.signatures)if(o.signatures.hasOwnProperty(u))if(e.hasOwnProperty(u)){if(o.signatures[u]!==e[u])throw r=new Error('Signature "'+u+'" is defined twice'),r.data={signature:u},r}else e[u]=o.signatures[u]}return C(t,e)}}),Y.create=e,Y.types=K,Y.conversions=X,Y.ignore=W,Y.convert=f,Y.find=i,Y.addType=function(n){if(!n||"string"!=typeof n.name||"function"!=typeof n.test)throw new TypeError("Object with properties {name: string, test: function} expected");Y.types.push(n)},Y.addConversion=function(n){if(!n||"string"!=typeof n.from||"string"!=typeof n.to||"function"!=typeof n.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");Y.conversions.push(n)},Y}return e()});