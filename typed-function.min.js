!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.typed=e()}(this,function(){"use strict";function compareTypes(t,e){return"any"===t?1:"any"===e?-1:"Object"===t?1:"Object"===e?-1:0}function getTypeTest(t){var e=typed.types[t];if(!e){var n=Object.keys(typed.types).filter(function(e){return e.toLowerCase()==t.toLowerCase()}).map(function(t){return'"'+t+'"'});throw new Error('Unknown type "'+t+'"'+(n.length?". Did you mean "+n.join(", or ")+"?":""))}return e}function Refs(t){this.name=t||"refs",this.categories={}}function Param(t,e){if("string"==typeof t)this.types=t.split("|").map(function(t){return t.trim()});else{if(!Array.isArray(t)){if(t instanceof Param)return t.clone();throw new Error("String or Array expected")}this.types=t}void 0!==this.types[0]&&"..."==this.types[0].substring(0,3)?(this.types[0]=this.types[0].substring(3)||"any",this.variable=!0):this.variable=e||!1}function Signature(t,e){if("string"==typeof t)this.params=""!==t?t.split(",").map(function(t){return new Param(t)}):[];else{if(!Array.isArray(t))throw new Error("string or Array expected");this.params=t.map(function(t){return new Param(t)})}var n=this.params.filter(function(t){return t.variable});if(0===n.length)this.variable=!1;else{if(n[0]!==this.params[this.params.length-1])throw new SyntaxError('Unexpected variable arguments operator "..."');this.variable=!0}this.fn=e}function Node(t){this.type=t,this.fn=null,this.variable=!1,this.childs={}}function RootNode(t){this.name=t||"",this.fn=null,this.childs={}}function splitSignatures(t){return Object.keys(t).reduce(function(e,n){var r=t[n],o=new Signature(n,r);return e.concat(o.split())},[])}function normalizeSignatures(t){var e={};return t.map(function(t){var n=t.params.join(",");if(n in e)throw new Error('Error: signature "'+n+'" defined twice');e[n]=t.fn}),e}function parseSignatures(t,e){var n=new RootNode(t);return e.forEach(function(t){for(var e=t.params.concat([]),r=n;e.length>0;){var o=e.shift(),i=o.types[0],s=r.childs[i];void 0===s&&(s=r.childs[i]=new Node(o)),r=s}r.fn=t.fn,r.variable=t.variable}),n}function minify(t){return t.replace(/\/\/.*/g,"").replace(/\s*\n\s*/gm,"").replace(/ \{/g,"{").replace(/ \(/g,"(").replace(/(signature|test|convert|arg)(?=\d)/g,function(t){return t.charAt(0)})}function _typed(name,signatures){var refs=new Refs,structure=splitSignatures(signatures),tree=parseSignatures(name,structure),treeCode=tree.toCode(refs),refsCode=refs.toCode(),factory=["(function ("+refs.name+") {",refsCode,treeCode,"})"].join("\n");typed.config.minify&&(factory=minify(factory));var fn=eval(factory)(refs);return fn.signatures=normalizeSignatures(structure),fn}Refs.prototype.add=function(t,e){var n=e||"fn";this.categories[n]||(this.categories[n]=[]);var r=this.categories[n].indexOf(t);return-1==r&&(r=this.categories[n].length,this.categories[n].push(t)),n+r},Refs.prototype.toCode=function(){var t=[],e=this.name+".categories",n=this.categories;return Object.keys(n).forEach(function(r){n[r].forEach(function(n,o){t.push("var "+r+o+" = "+e+"['"+r+"']["+o+"];")})}),t.join("\n")},Param.prototype.clone=function(){return new Param(this.types.slice(),this.variable)},Param.prototype.toString=function(){return(this.variable?"...":"")+this.types.join("|")},Signature.prototype.split=function(){function t(n,r,o){if(o<n.params.length){var i=n.params[o];i.types.forEach(function(e){t(n,r.concat(new Param(e,i.variable)),o+1)})}else e.push(new Signature(r,n.fn))}var e=[];return t(this,[],0),e},Node.prototype.depth=function(){var t=0;return Object.keys(this.childs).forEach(function(e){var n=this.childs[e].depth()+1;t=Math.max(t,n)}.bind(this)),t},Node.prototype._toCode=function(t,e,n,r){var o,i=[],s=void 0!==this.type?this.type.types[0]:void 0;if(this.variable)"any"==s?(i.push(r+"var varArgs = [];"),i.push(r+"for (var i = "+(e.length-1)+"; i < arguments.length; i++) {"),i.push(r+"  varArgs.push(arguments[i]);"),i.push(r+"}"),i=i.concat(this._contentToCode(t,e,n,r))):(o=t.add(getTypeTest(s),"test"),i.push(r+"var match = true;"),i.push(r+"var varArgs = [];"),i.push(r+"for (var i = "+(e.length-1)+"; i < arguments.length; i++) {"),i.push(r+"  if ("+o+"(arguments[i])) {"),i.push(r+"    varArgs.push(arguments[i]);"),i.push(r+"  } else {"),i.push(r+"    match = false;"),i.push(r+"    break;"),i.push(r+"  }"),i.push(r+"}"),i.push(r+"if (match) {"),i=i.concat(this._contentToCode(t,e,n,r+"  ")),i.push(r+"}"));else if("any"==s)i=i.concat(this._contentToCode(t,e,n,r));else{o=t.add(getTypeTest(s),"test");var a="arg"+(e.length-1);i.push(r+"if ("+o+"("+a+")) { // type: "+s),i=i.concat(this._contentToCode(t,e,n,r+"  ")),i.push(r+"}")}return i.join("\n")},Node.prototype._contentToCode=function(t,e,n,r){var o=[];if(this.fn){var i=this.variable?">=":"===",s=t.add(this.fn,"signature");o.push(r+"if (arguments.length "+i+" "+e.length+") {"),o.push(r+"  return "+s+"("+e.join(", ")+"); // signature: "+n.join(", ")),o.push(r+"}")}return this.forEach(function(i){var s=i.variable?"varArgs":"arg"+e.length;o.push(i._toCode(t,e.concat(s),n.concat(i.type),r))}),o=o.concat(this._conversionsToCode(t,e,n,r))},Node.prototype._conversionsToCode=function(t,e,n,r){var o=[],i={};return typed.conversions.filter(function(t){return void 0===this.childs[t.to]||i[t.from]?!1:(i[t.from]=!0,!0)}.bind(this)).forEach(function(i){var s,a,u=i.to,c=this.childs[u];c.variable?(o.push(r+"var match = true;"),o.push(r+"var varArgs = [];"),o.push(r+"for (var i = "+e.length+"; i < arguments.length; i++) {"),s=t.add(getTypeTest(u),"test"),a=t.add(i.convert,"convert"),o.push(r+"  if ("+s+"(arguments[i])) { // type: "+i.to),o.push(r+"    varArgs.push(arguments[i]);"),typed.conversions.filter(function(t){return t.to==u}).forEach(function(e){var n=t.add(getTypeTest(e.from),"test")+"(arguments[i])",i=t.add(e.convert,"convert")+"(arguments[i])";o.push(r+"  } else if ("+n+") { // type: "+e.from+", convert to "+e.to),o.push(r+"    varArgs.push("+i+");")}),o.push(r+"  } else {"),o.push(r+"    match = false;"),o.push(r+"    break;"),o.push(r+"  }"),o.push(r+"}"),o.push(r+"if (match) {"),o=o.concat(c._contentToCode(t,e.concat("varArgs"),n.concat(c.type),r+"  ")),o.push(r+"}")):(s=t.add(getTypeTest(i.from),"test")+"(arguments["+e.length+"])",a=t.add(i.convert,"convert")+"(arguments["+e.length+"])",o.push(r+"if ("+s+") { // type: "+i.from+", convert to "+i.to),o=o.concat(c._contentToCode(t,e.concat(a),n.concat(c.type),r+"  ")),o.push(r+"}"))}.bind(this)),o},Node.prototype.forEach=function(t){Object.keys(this.childs).sort(compareTypes).forEach(function(e){t(this.childs[e])}.bind(this))},RootNode.prototype=Object.create(Node.prototype),RootNode.prototype.toCode=function(t){for(var e=[],n=this.depth(),r=[],o=0;n>o;o++)r[o]="arg"+o;var i=[],s=[],a="";return e.push("return function "+this.name+"("+r.join(", ")+") {"),e=e.concat(this._contentToCode(t,i,s,a+"  ")),e.push("  throw new TypeError('Wrong function signature');"),e.push("}"),e.join("\n")};var types={"null":function(t){return null===t},"boolean":function(t){return"boolean"==typeof t},number:function(t){return"number"==typeof t},string:function(t){return"string"==typeof t},"function":function(t){return"function"==typeof t},Array:function(t){return Array.isArray(t)},Date:function(t){return t instanceof Date},RegExp:function(t){return t instanceof RegExp},Object:function(t){return"object"==typeof t}},config={minify:!0},conversions=[],typed={config:config,types:types,conversions:conversions};return typed=_typed("typed",{Object:function(t){return _typed(null,t)},"string, Object":_typed,"string, function":function(t,e){var n={};return n[t]=e,_typed(null,n)},"string, string, function":function(t,e,n){var r={};return r[e]=n,_typed(t,r)}}),typed.config=config,typed.types=types,typed.conversions=conversions,typed});